# フェーズ1：コア基盤構築

## 概要
- 期間目安: 3週間
- データ駆動型のレジストリと CLI 基盤を整備し、以降の開発フローを支える土台を用意するフェーズ。

## 目的
- レジストリ JSON スキーマとバリデーションロジックを実装し、データ品質を保証する。
- CLI α版を提供し、プロジェクト・ドキュメント操作の基本フローを通せるようにする。
- CLI/レジストリのテスト方針とモジュール構成、バックアップ運用ルールを確定し、後続機能追加を容易にする。
- DECISIONS.md で合意した戦略（単一 JSON 運用、Pagefind 採用、翻訳ステータス項目など）を反映する。

## 主な成果物
- `registry/docs.schema.json`（正式スキーマ）とサンプルデータセット。
- `registry/schema/` 配下のスキーマバージョン管理（`$schemaVersion` 導入）。
- `tools/docs-cli` α版（add-project, add-doc, add-version, add-language, migrate-from-libx, validate の基本コマンド）。
- バリデーションテスト（単体/スナップショット）と CI 設定ファイル（Lint + Schema check）。
- バリデーションテスト（単体/スナップショット）と CI 設定ファイル（Schema check + レジストリ/コンテンツ整合 + Astro ビルド）。
- 技術ガイド: レジストリ記述ルール、CLI 拡張ガイドライン、バックアップ/ロールバック手順。
- `.docs-cli/config.json` テンプレートと CI からの非対話実行サンプル。

## 想定タスク
- JSON スキーマ設計とバリデーションユーティリティ実装（Ajv 等を想定）。
- CLI フレームワーク選定（例: Commander.js）とプロトタイプ構築。
- コマンド実行ログ・エラーハンドリングポリシー、`.backups/` 運用ルールの設計。
- ユニットテスト/スナップショットテストの整備、CI の初期導入（フェーズ1目標カバレッジ: スキーマ検証 + Astro ビルド + Validate）。
- フェーズ0 成果物との整合確認（ユースケース網羅性、DECISIONS.md 反映状況レビュー）。
- `documents[].related`・`glossary` など拡張フィールドのスキーマ定義。

### タスクブレークダウン
- **レジストリスキーマ**
  - `registry/docs.schema.json` の基本構造定義と `$schemaVersion` 導入。
  - `LanguageConfig`, `VersionConfig`, `Document`, `Glossary` の詳細スキーマ作成。
  - スキーマ変更追跡用の `registry/schema/CHANGELOG.md` 作成。
- **バリデーションツール**
  - Ajv ベースのバリデーター実装（コマンドライン/API の双方）。
  - レジストリと `content/` の整合チェックユーティリティ実装。
  - エラーコードとメッセージ一覧作成（国際化対応を見据え JSON で管理）。
- **CLI 基盤**
  - Commander.js（または同等）で CLI エントリ (`docs-cli`) を構築。
  - `add-project/add-version/add-language/add-doc/migrate-from-libx/validate` 実装。
  - ログ出力ポリシーと `.backups/` スナップショット保存処理の共通化。
  - `.docs-cli/config.json` 読み込みと環境変数優先ルールの実装。
- **テストと CI**
  - ユニットテスト（スキーマ検証、CLI コマンド、バックアップ復元）。
  - Astro ビルド検証のためのミニマムプロジェクト作成。
  - GitHub Actions（lint → schema → validate → build）ワークフロー整備。
- **ドキュメント**
  - レジストリ記述ガイド (`docs/new-generator-plan/guides/registry.md`) のドラフト作成。
  - CLI 使い方 (`docs/new-generator-plan/guides/docs-cli.md`) の初版執筆。
  - CI サンプル (`docs/new-generator-plan/examples/ci.md`) の作成。

## 体制・ステークホルダー
- テックリード: スキーマ設計レビュー、技術選定承認。
- CLI 実装担当（2名程度想定）: CLI 基盤とコマンド実装。
- QA リード: バリデーション要件とテスト戦略の合意。
- コンテンツリード: CLI UX（入力項目、メッセージ）に対するフィードバック。

## 依存関係と前提
- フェーズ0で合意したレジストリ項目とユースケースが確定している。
- 利用するパッケージ（Ajv、Commander など）のライセンスと互換性を確認済み。
- CI 実行環境（GitHub Actions 等）へのアクセス権がある。

## リスクと緩和策
- スキーマが過度に複雑化 → モジュール分割し、オプション項目は階層化で対応する。
- CLI UX が難解 → 初期ユーザー（翻訳/編集担当）にプロトタイプを試してもらい、早期に改善サイクルを回す。
- テスト整備の遅延 → MVP レベルの必須テスト項目（スキーマ検証、コマンド成功/失敗パス、Astro ビルド）を先に書き上げる。
- バックアップ量が肥大化 → 保持期間とクリーンアップコマンドを定義し、CI 実行時はドライランモードを活用する。

## 成功基準
- スキーマの自動検証が CI で問題なく実行される。
- CLI α版でサンプルプロジェクトの作成〜ドキュメント追加〜翻訳ステータス更新まで一連の操作が成功する。
- フィードバックを反映した CLI UX 改善事項がチケット化され、フェーズ2 以降で対応可能な状態になっている。
- `.docs-cli/config.json` を利用した非対話 CI 実行がドキュメント化され、再現できる。

## メトリクスとチェックポイント
- 実装済み CLI コマンド数 / 計画コマンド数（80%以上）。
- スキーマバリデーション成功率（100%を目指す）。
- CI パイプライン成功率（スキーマ＋整合＋ビルドが連続成功）。
- フィードバックループ回数と対応状況を週次レビューで確認。
