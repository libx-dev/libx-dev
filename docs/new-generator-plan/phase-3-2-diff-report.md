# フェーズ3-2：差分レポート／検証詳細計画

## 目的
- 旧サイトと新サイトの差異を可視化・検証する仕組みを整備し、移行作業の品質と効率を高める。
- レポート結果をレビューしやすい形式（HTML/CSV/JSON）で出力し、承認プロセスを支援する。

## スコープ
- URL・メタデータ・ページ内容・検索結果の比較。  
- レポート生成スクリプトとレビューテンプレート。  
- 旧ビルドと新ビルドの比較自動化（CI との連携）。

## タスク
1. **データ収集**
   - 旧サイト（libx-dev dist）と新ジェネレーター出力を並行ビルド。  
   - URL リスト、サイトマップ、Pagefind インデックス、Glossary を収集。
2. **比較ロジック**
   - ルーティング差分（追加／削除／移動）、リダイレクト確認。  
   - メタデータ（タイトル、description、OG、keywords）比較。  
   - コンテンツ差分（Markdown AST ベース）で主要変更点を抽出。
3. **検索比較**
   - 代表クエリを定義し、旧/新の検索結果上位 N 件を比較。  
   - ゼロヒットクエリ、関連リンク、Glossary 表示の差異をレポート。
4. **レポート出力**
   - HTML レポート：概要、重大差分、プレビューリンク。  
   - CSV / JSON：レビューで利用しやすい形式。  
   - CLI `migrate-from-libx --report <path>` で出力先指定可能にする。
5. **レビュー支援**
   - レポート閲覧手順書とステータス記録テンプレート（`docs/new-generator-plan/templates/migration-review.md`）を作成。  
   - レビュー結果を Issue 化し、対応状況を追跡。
6. **CI 連携**
   - GitHub Actions で差分レポートを生成し Artifact として添付。  
   - 大きな差分が検出された場合に警告（PR コメント）を投稿。

## 成果物
- 差分比較スクリプトと CLI オプション。  
- HTML/CSV/JSON レポート。  
- レビューガイドとテンプレート。  
- CI での自動レポート（Artifact）。

## 完了条件
- 代表プロジェクトで差分レポートが正しく生成され、レビューと承認が行える。  
- CI で自動生成されたレポートが確認でき、重大差分を検知できる。  
- レビュー手順書に従って承認された成果物がログとして残る。
