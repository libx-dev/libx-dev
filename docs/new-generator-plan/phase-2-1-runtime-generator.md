# フェーズ2-1：ランタイム／ジェネレーター詳細計画

## 目的
- レジストリに定義されたデータ構造をもとに、Astro サイトのルーティング・ナビゲーション・レイアウトを自動生成するビルドエンジンを確立する。
- Visibility や関連リンクなど新メタデータを UI/UX に反映し、最終的な統合サイトを 1 回のビルドで出力できるようにする。

## スコープ
- `src/generator/` モジュールの設計・実装（ルーティング、サイドバー、サイトマップ、ページメタの生成）。
- `src/runtime/` におけるページテンプレート、レイアウト、補助コンポーネントの実装。
- Visibility（`public`/`internal`/`draft`）や `related` メタの反映ロジック、アクセス制御。

## タスク
1. **ルーティング生成**
   - プロジェクト/バージョン/言語/slug をもとに動的ルーティングを定義。  
   - Visibility に応じてページ生成可否を制御し、`draft` はビルド除外、`internal` は特定出力ディレクトリに限定。
2. **サイドバー／ナビゲーション**
   - CategoryConfig から階層構造を構築し、サイドバー用 JSON を生成。  
   - 現在地ハイライト、展開状態復元のためのデータ属性を付与。
3. **ページレイアウト**
   - レジストリの `title`, `summary`, `contributors`, `license`, `related` をページに反映。  
   - `related` リストから関連記事カードを生成。  
   - Glossary 用セクションを追加（該当用語が存在する場合のみ表示）。
4. **サイトマップ／メタ生成**
   - `sitemap.xml` と `robots.txt` を生成し、Visibility ルールに従って除外。  
   - `manifest.json` や OpenGraph/SEO メタをプロジェクト設定から生成。
5. **テスト**
   - 生成されたルーティング／サイドバー／サイトマップのスナップショットテスト。  
   - Visibility/draft のビルド除外が正しく行われるかの自動テスト。
6. **ドキュメント**
   - ジェネレーター構成図を作成し、`docs/new-generator-plan/guides/runtime.md` としてまとめる。  
   - ルーティング／サイドバー／メタ生成の拡張ポイントを説明。

## 成果物
- `src/generator/*` および `src/runtime/*` のコードとテスト。
- 生成物（サイドバー JSON、サイトマップ、OG メタ設定）のサンプル。
- ランタイム構成ドキュメント。

## 完了条件
- `pnpm build` でレジストリから全ページが生成され、Visibility ルールが適用される。
- サイドバー・ナビゲーションが正しく生成され、レイアウトで `related` や Glossary が表示される。
- テストでルーティング／メタ生成のリグレッションが検知可能になっている。
