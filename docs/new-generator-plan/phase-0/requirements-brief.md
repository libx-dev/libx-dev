# 要件ブリーフ（フェーズ0成果物）

## 1. ビジネス要件
- **ドキュメント運用効率化**  
  - 3リポジトリ連携や手作業スクリプト操作を不要にし、単一リポジトリ・単一ビルドで完結する。
  - 翻訳チームやドキュメント編集者が CLI と JSON 管理だけでコンテンツを更新できる。
- **既存ブランド体験の継承**  
  - libx-dev で確立した UI/テーマを再利用し、ユーザー向けの外観や操作性を維持する。
- **スケール可能な運用モデル**  
  - プロジェクト数やバージョンが増加してもビルド時間・同期コストを抑えられる構造にする。
- **デプロイ安定化と可視化**  
  - Cloudflare Pages を標準ターゲットとし、ビルド〜デプロイの状態を CI で可視化する。

## 2. 技術要件
- **単一ビルドパイプライン**  
  - Astro ベースで最終統合サイトを 1 回のビルドで生成する。  
  - レジストリ（JSON）からルーティング・サイドバー・検索メタ等を自動生成。
- **データ駆動レジストリ**  
  - プロジェクト/バージョン/言語/カテゴリ/ドキュメント/ライセンス/翻訳ステータスなどを JSON Schema で定義し、CLI で CRUD 可能にする。
- **CLI 中心のワークフロー**  
  - `docs-cli`（仮）でプロジェクト・ドキュメント操作、検証、移行、ビルド補助を実行できるようにする。
- **検索/ナビゲーション戦略**  
   - 初期バージョンでは Pagefind を標準検索エンジンとして採用し、`documents` の `keywords`/`tags`/`related` メタをビルドで活用する。  
   - Algolia 等の外部サービス連携はフェーズ2 以降の拡張候補として比較検証する。
- **移行互換層**  
  - libx-dev 既存データ（`project.config.json`, MDX 構造）から新レジストリへ変換する自動ツールを提供。
- **共有資産の再利用**  
  - `@docs/ui`, `@docs/theme`, `@docs/i18n`, `@docs/versioning` を抽出・整理し、新ジェネレーターから参照可能なモジュールとして整備。
- **共有パッケージ配布**  
   - npm 公開可能なパッケージ化を第一候補とし、移行期間中は Git サブモジュール案もバックアップとして検討する（フェーズ1で PoC）。
- **検索・ナビゲーション強化**  
  - 静的検索（Pagefind 等）やタグ/メタ生成をビルド工程に組み込む余白を設計段階で確保。

## 3. 非機能要件
- **性能**: ビルド時間は libx-dev 現状（統合ビルド + サイドバー生成）より短縮、開発環境ではホットリロードを維持。  
- **信頼性**: フェーズ1で JSON スキーマ検証・レジストリとコンテンツ整合・Astro ビルドを必須CIに組み込み、フェーズ2でリンク/アクセシビリティ/翻訳整合チェックを拡張。  
- **可観測性**: CLI と CI のログを統一フォーマット化し、失敗時に原因とロールバック手順が明確になる。  
- **保守性**: レジストリスキーマと CLI コマンドにバージョニングを導入し、互換性破壊変更の通知フローを用意。  
- **拡張性**: 翻訳支援 SaaS や外部 API 連携を将来的に追加できる拡張ポイントを確保。  
- **国際化**: 多言語対応（既存の 14 言語）とバージョン運用を継続し、未翻訳状態の検知を自動化。

## 4. ステークホルダー要求と期待値
- **プロダクトオーナー（仮）**: リポジトリ構造簡素化、ビルド・デプロイの透明性、コスト削減。  
- **テックリード（Codex 担当）**: レジストリ/CLI/ビルドのアーキテクチャ設計と実装をリード。  
- **コンテンツ担当（ユーザー）**: CLI ベースで言語追加・ドキュメント更新ができ、翻訳ステータスが把握できる。  
- **QA（兼任）**: 自動化された検証とチェックリストで品質保証を担保。

## 5. 前提・制約
- 主要技術スタックは Astro + MDX を継続利用（必要に応じて最新機能を採用）。  
- ネットワーク制約環境での開発を想定し、外部サービス連携は後続フェーズの検討とする。  
- CLI は Node.js 18 以上、pnpm を前提。  
- 既存リポジトリからの移行中は一時的に並行運用を許容する。

## 6. 成功指標（フェーズ横断で追跡）
- ビルド時間短縮率（libx-dev 比）。  
- CLI 利用率（手動スクリプト操作が置き換わっている割合）。  
- レジストリバリデーション合格率（CI での失敗ゼロを目指す）。  
- 移行時の自動変換成功率（90%以上自動化）。  
- 翻訳未整合検出件数（リリース前にゼロを目標）。
