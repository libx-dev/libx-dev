# フェーズ3：移行準備

## 概要
- 期間目安: 3週間
- 既存の libx-dev コンテンツと運用を新ジェネレーターへ移行するためのツールとガイドラインを整備するフェーズ。

## 目的
- 設定ファイルと MDX コンテンツを新レジストリ形式へ自動変換するマイグレーションツールを提供する。
- CI/CD フローを新ジェネレーター用に構成し、品質検証の自動化を確立する。
- 旧ツールから新 CLI へ移行するための互換レイヤーとドキュメントを整備する。
- libx-dev / libx-docs からの移行を段階的に実施し、フェーズ3完了時点で libx-docs の今後の役割を判断できる状態にする。

## 主な成果物
- `tools/docs-cli migrate-from-libx` コマンド（設定/コンテンツ変換、差分レポート生成）。
- サイドバイサイド検証スクリプト（旧サイト vs 新サイトのリンク比較、メタデータ差異チェック）。
- GitHub Actions（または相当）の CI テンプレート（スキーマ検証、ビルド、リンクチェック）。
- 移行手順書（前提条件、実行手順、ロールバック手順、チェックリスト）。
- `docs/new-generator-plan/examples/ci.md`：CI での `docs-cli` 実行例。
- `.backups/` 運用ガイドとクリーンアップ手順。
- libx-docs 維持/縮小案の提案メモ。

## 想定タスク
- 既存 `project.config.json` / `projects.config.json` 解析ロジックの実装。
- MDX ファイルの番号付け・カテゴリ情報を docId として再構成するアルゴリズム開発。
- 変換結果の差分レポート（追加/削除/変更）出力機能の実装。
- CI テンプレート作成・ドキュメント整備、社内環境での検証。
- 互換ラッパースクリプト（旧コマンド → 新 CLI）実装とテスト。
- `content.lang.source` / `syncHash` 情報の移行と検証。
- `glossary`, `related`, `visibility` など新フィールドに対応したデータ整形ルールの追加。
- libx-docs をソースとして維持する場合の運用手順、縮小案比較。

### タスクブレークダウン
- **データ変換ロジック**
  - `migrate-from-libx` で project/config JSON を読み込み、レジストリ規定へマッピング。
  - カテゴリ・ドキュメントの番号付き構造を docId/slug へ変換するアルゴリズム実装。
  - `content.lang` に `status`, `lastUpdated`, `reviewer`, `source`, `syncHash` を付与。
- **差分レポート/検証**
  - HTML/CSV/JSON の差分レポート生成（リンク、有無、翻訳ステータス）。
  - 旧⇔新ビルド結果比較スクリプト（URL リスト、Pagefind 結果、Glossary）実装。
  - レポート閲覧用テンプレートとレビュー手順書作成。
- **互換レイヤー**
  - 既存スクリプトの CLI ラッパー（例: `node scripts/add-language` → `docs-cli add-language`）実装。
  - `.backups/` ローテーションとロールバックコマンドの整理。
- **CI/自動化**
  - GitHub Actions テンプレート更新（schema → validate → build → link-check）。
  - `docs/new-generator-plan/examples/ci.md` にサンプル YAML を掲載。
  - CI での Pagefind インデックス生成と確認ステップ追加。
- **移行作業計画**
  - 対象プロジェクトごとの移行順序とタイムライン策定。
  - libx-docs 維持/縮小案の評価資料作成、意思決定ミーティングの調整。
- **ドキュメント**
  - 移行手順書（準備 → 実行 → 検証 → ロールバック）作成。
  - FAQ / トラブルシューティングセクション追加。

## 体制・ステークホルダー
- テックリード: ツール仕様の承認、重大仕様変更の判断。
- 開発チーム（スクリプト担当）: マイグレーション実装、CI 設定。
- コンテンツリード: 変換後データの整合性チェック、編集フローの確認。
- QA リード: チェックリスト策定と検証支援。

## 依存関係と前提
- フェーズ2でビルド済みサイトの構造が固まっている。
- 移行対象の libx-dev データが最新で、アクセス可能。
- CI 実行環境に必要な権限を取得済み。

## リスクと緩和策
- 自動変換の精度不足 → 変換プレビューと手動補正手順を明示、重要項目は WYSIWYG レポートで確認できるようにする。
- 差分確認が煩雑 → レポート生成を CSV/HTML 等で柔軟に出力し、レビューツールで参照しやすくする。
- CI 内で外部サービス連携が必要 → 事前に必要なトークン/設定を棚卸し、代替案（モック、ローカルCI）を用意。
- バックアップ肥大化 → マイグレーション実行時に古い `.backups/` をローテーション削除するコマンドを提供する。
- libx-docs 運用判断が遅れる → フェーズ3中盤で暫定結論をレビューし、フェーズ4序盤までに確定する。

## 成功基準
- 代表的な libx-dev プロジェクトを対象に、設定＋MDX がツールで 90%以上自動移行できる。
- CI テンプレートを用いたビルド・リンクチェックが正常に完了する。
- 移行手順書に従ってテスト移行を実施し、承認された。
- `syncHash` や `source` 情報が整合しており、差分レポートで不整合がゼロである。
- libx-docs 維持/縮小方針について合意が取れている。

## メトリクスとチェックポイント
- 自動移行成功率（自動適用／手動補正件数）。
- 差分レポートのレビュー完了数（レビュー済みプロジェクト数）。
- CI 実行時間と成功率（安定稼働の確認）。
- バックアップ保管容量とローテーション結果。
- libx-docs 方針レビューの実施時期と決定状況。
